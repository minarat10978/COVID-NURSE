<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nurse</title>
  <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> -->
	<style>
          #pictureUrl { display: block; margin: 0 auto }
        </style>
</head>

<body>
	 <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<script>
          function runApp() {
            liff.getProfile().then(profile => {
              document.getElementById("pictureUrl").src = profile.pictureUrl;
              document.getElementById("userId").innerHTML = '<b>UserId:</b> ' + profile.userId;
              document.getElementById("userId2").innerHTML = profile.userId;
              document.getElementById("displayName").innerHTML =  profile.displayName;
             
            }).catch(err => console.error(err));
          }
          liff.init({ liffId: "1656058918-EV7kbody" }, () => {
            if (liff.isLoggedIn()) {
              runApp()
            } else {
              liff.login();
            }
          }).then(() => {
              // start to use LIFF's api
              initializeApp();
          })
          .catch((err) => {
            
          });
         
        </script>  
<div class="container mt-3">
 
     <br>
 
     
          <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#home">Home</a>
              </li>
        
             
            </ul>
          
    
  <!-- Tab panes -->
  <div class="tab-content">
    <div id="home" class="container tab-pane active"><br>
      <h6>รายชื่อบุคคลขอรับการตรวจด้วยชุดน้ำยา 2019-nCoV Av Test</h6>
      <input style="display: none;" type="text" class="form-control" id="assessorIDx" name="assessorIDx" readonly>
     
      
      <div class="card-body" style="padding-left: 0%;">
          <div class="table-responsive" style="background-color: white;">
          <table class="table table-hover m-0 datax">
              <thead>
              <tr>
              <th>ID</th>
              <th>ชื่อ-นามสกุล</th>
	      <th>วันที่ต้องการตรวจ</th>
	       <th>รายละเอียด</th>
              <th style="padding-left: 100px"></th>
              
              </tr>
              </thead>
              <tbody id="myTable">
              <tr>
              <td></td>
              <td></td>
              <td width=50%></td>
              
              </tr>
          
              </tbody>
          </table>
          </div>
          <!-- /.table-responsive -->
      </div>

    </div>

  </div>
</div>
<script type="text/javascript">
  $(document).ready(function () {

  
   
  var  assessorIDid = localStorage.getItem("assessorinfoID");
    localStorage.getItem("assessorinfoID");
    getassessor()
    $("#assessorIDx").val(assessorIDid);

    $('#logout').on('click', function(e){
  swal({
  title: "Are you sure you want to logout?",
  text: "",
  icon: "warning",
  buttons: true,
  // buttons: ["ย้อนกลับ", "ยืนยัน"],
  dangerMode: true,
  })
  .then((willDelete) => {
  if (willDelete) {

    window.location = "index.html";
    // window.location.href = "https://reservedocument-f6fd7.web.app";
    console.clear();
  } else {

  }
  });

});
$(".sendBtn").click(function(){
          summit()
          // alert($("input[name='WF1']:checked").val())
        });
        function summit(){
					 validateFeild();
					//  calcscore();
					var formtest = $(".formX").serializeArray();
					// var formtestx = $(".formX").serializeObject();
					console.log(formtest);
					
					if (validated == true ) {
				
						var settings = {
								"url": "https://projectx.boonrawd.co.th/singhaway/api/assessor/",
								"method": "POST",
								"timeout": 0,
								"headers": {
									"Content-Type": "application/json"
								},
								"data": JSON.stringify({"inputassessorID":0,"assessorID":localStorage.getItem("assessorID"),"WF1":$("input[name='WF1']:checked").val(),"WF2":$("input[name='WF2']:checked").val(),"WF3":$("input[name='WF3']:checked").val(),"WF4":$("input[name='WF4']:checked").val(),"WC1":$("input[name='WC1']:checked").val(),"WC2":$("input[name='WC2']:checked").val(),"WC3":$("input[name='WC3']:checked").val(),"WC4":$("input[name='WC4']:checked").val(),"WQ1":$("input[name='WQ1']:checked").val(),"WQ2":$("input[name='WQ2']:checked").val(),"WQ3":$("input[name='WQ3']:checked").val(),"WQ4":$("input[name='WQ4']:checked").val(),"WH1":$("input[name='WH1']:checked").val(),"WH2":$("input[name='WH2']:checked").val(),"WH3":$("input[name='WH3']:checked").val(),"WH4":$("input[name='WH4']:checked").val(),"active":1})};
                
								$.ajax(settings).done(function (response) {
								console.log(response);
									
									
									if (response.result == "success") {
								
                      swal({
                        title: "Good job!",
                        // text: " ขอเชิญท่านประเมินความพึงพอใจ การบริการในภาพรวม ที่ดำเนินการโดยกลุ่มวิศวกรรมกลาง และหน่วยงานสังกัดสายวิศวกรรมและสารสนเทศ ",
                        text: "บันทึกสำเร็จ!",
                        icon: "success",
                        
                        buttons: true,
                        buttons: "OK"
                        }).then((value) => {
                          window.location.href = "https://brb-cteg.github.io/Singha-Way/home.html";
                          // localStorage.clear()
                          // window.localStorage.removeItem('inputreserveName');
                       
                        });
									} else {
					
                    swal("ไม่สำเร้จ!", "กรุณาตรวจสอบความถูกต้องของข้อมูล!", "warning");
									
									}
							
								});
						
						validated = false;

					} else  {
            // swal("บันทึกข้อมูลไม่สำเร็จ!", "", "warning");       
						// swal('กรุณากรอกรายละเอียดของหนังสือออก');
            if ($("#inputreserveName").val() == "") {
						// alert('กรุณาประเมินคะแนน');
            swal("บันทึกข้อมูลไม่สำเร็จ!", "กรุณากรอกรายละเอียดของหนังสือออก", "warning"); 
						// $("#inputreserveName").removeClass("alert-primary").addClass("alert-danger");
					
					} else {
						// $("#inputreserveName").removeClass("alert-danger").addClass("alert-primary");
					
					}
          if ($("#division").val() == "เลือกสังกัด/หน่วยงาน") {
						// alert('กรุณาประเมินคะแนน');
            swal("บันทึกข้อมูลไม่สำเร็จ!", "กรุณาเลือกสังกัด/หน่วยงาน", "warning");  
						// $("#inputreserveName").removeClass("alert-primary").addClass("alert-danger");
					

					} else {
						// $("#inputreserveName").removeClass("alert-danger").addClass("alert-primary");
					
					}
          if ($("#approveName").val() == "เลือกผู้ลงนามอนุมัติเอกสาร") {
						// alert('กรุณาประเมินคะแนน');
            swal("บันทึกข้อมูลไม่สำเร็จ!", "กรุณาเลือกผู้ลงนามอนุมัติเอกสาร", "warning");  
						// $("#inputreserveName").removeClass("alert-primary").addClass("alert-danger");
				

					} else {
						// $("#inputreserveName").removeClass("alert-danger").addClass("alert-primary");
					
					}
					}
					
					
        };
        function validateFeild(){
				
      
        if ($("#dateTimes").val() == "dd/mm/yyyy") {
          // alert('กรุณาประเมินคะแนน');
          // swal("บันทึกข้อมูลไม่สำเร็จ!", "กรุณาเลือกผู้ลงนามอนุมัติเอกสาร", "warning");  
          // $("#inputreserveName").removeClass("alert-primary").addClass("alert-danger");
          validated =  false;
 
          return false;

        } else {
          // $("#inputreserveName").removeClass("alert-danger").addClass("alert-primary");
          validated = true;
        }
        };
function getassessor(){

var settings = {
    "url": "https://docreserv-cteg.boonrawd.co.th/covid/api/inputNurse/get/",
    "method": "POST",
    "timeout": 0,
    "headers": {
      "Content-Type": "application/json"
    },
    //"data": JSON.stringify({"assessorinfoID":localStorage.getItem("assessorinfoID")}),
    };

    $.ajax(settings).done(function (response) {
    console.log(response);
      if (response.result == "success") {
        console.log(response.data);
        // var inputReserveIDxx = response.data.inputReserveID
        $(".datax tbody").html("")
       
        response.data.forEach((value,index)=>{
          console.log(value,index)
          

          if(value.active == 1){
            var f='<tr> <td>' + (index + 1) + '</td> <td data='+value.fullname+'>'+value.fullname+'</td> <td data-name="'+value.dateTimes+'">'+value.dateTimes+'</td><td data-name="'+value.Detail+'">'+value.Detail+'</td><td><button data='+value.active+' data-id='+value.inputdetecID+'  type="button" class="btn btn-success " >ตรวจเสร็จแล้ว</button></td></tr>'
          }else{
            var f='<tr> <td>' + (index + 1) + '</td> <td data='+value.fullname+'>'+value.fullname+'</td> <td  data-name="'+value.dateTimes+'">'+value.dateTimes+'</td><td data-name="'+value.Detail+'">'+value.Detail+'</td><td><button data='+value.active+' data-id='+value.inputdetecID+' type="button" class="btn btn-warning btnassessor">ยังไม่ได้ตรวจ</button></td></tr>'
          }
 
          $(".datax tbody").append(f)
         
         
          
        });
  
        $(".btnassessor").on("click",function(){

          var approve = $(this).attr('data')
	  var inputdetecID = $(this).attr('data-id')
	  localStorage.getItem("inputdetecID");
	  
          $("#name").val(inputdetecID);
		var settings = {
                              "url": "https://docreserv-cteg.boonrawd.co.th/covid/api/inputNurse/",
                              "method": "POST",
                              "timeout": 0,
                              "headers": {
                                "Content-Type": "application/json"
                              },
                              "data": JSON.stringify({"inputdetecID": $(this).attr('data-id')}),
                        }

                              $.ajax(settings).done(function (response) {
                             
                                if (response.result == "success") {
                                
                                    location.reload();
//                                    
                                } else {
                                
                                 
                                  swal("Hello world!");
                                
                                }
                            
                              });
          
        


          });  

         

      } else {

                       
      }
      
    });

};

  });

</script>

</body>
</html>
